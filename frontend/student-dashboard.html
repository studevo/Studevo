<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Dashboard ‚Äî Studevo</title>
  <script>
    // ‚úÖ CORRECT AUTH CHECK ‚Äî runs BEFORE page renders
    const user = JSON.parse(localStorage.getItem('studyconnectUser'));
    if (!user || !user.isLoggedIn || user.role !== 'student') {
      alert('Please log in to access the dashboard.');
      window.location.href = 'index.html';
    }
  </script>
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    body { 
      font-family: 'Segoe UI', sans-serif; 
      background: #f8fafc; 
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .container { 
      width: 95%;
      max-width: 1400px; 
      margin: 0 auto; 
      padding: 20px;
      flex: 1;
    }
    header { 
      background: white; 
      padding: 15px 0; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
    }
    .header-content { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      width: 95%;
      max-width: 1400px; 
      margin: 0 auto; 
    }
    .logo { 
      font-size: 24px; 
      font-weight: 800; 
      color: #3b82f6; 
      text-decoration: none; /* Removed underline */
    }
    .logo span { 
      color: #1e40af; 
    }
    .user-menu { 
      display: flex; 
      align-items: center; 
      gap: 15px; 
    }
    .header-btn {
      background: #3b82f6;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
      position: relative;
      font-size: 18px;
    }
    .header-btn:hover {
      background: #2563eb;
    }
    .logout-btn {
      background: #ef4444;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
    }
    .logout-btn:hover {
      background: #dc2626;
    }
    /* ====== NEW NOTIFICATION BELL STYLES (from org dashboard) ====== */
    .notification-bell {
      position: relative;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8fafc;
      color: #64748b;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .notification-bell:hover,
    .notification-bell.active {
      background: #dbeafe;
      color: #3b82f6;
    }
    .notification-bell svg {
      width: 20px;
      height: 20px;
      stroke: currentColor;
    }
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      font-size: 10px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .dashboard-header { 
      text-align: center; 
      margin-bottom: 40px; 
    }
    .dashboard-header h1 { 
      font-size: 32px; 
      color: #1e293b; 
      margin-bottom: 10px; 
    }
    .dashboard-header p { 
      color: #64748b; 
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      flex: 1;
      margin-bottom: 40px;
    }
    .action-card {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
    }
    .action-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
    }
    .card-icon {
      font-size: 40px;
      margin-bottom: 20px;
      color: #3b82f6;
    }
    .action-card h3 {
      margin-bottom: 15px;
      color: #1e293b;
      font-size: 20px;
    }
    .action-card p {
      color: #64748b;
      margin-bottom: 20px;
      font-size: 15px;
      line-height: 1.5;
      flex: 1;
    }
    .stats-overview {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 20px 0;
      flex: 1;
    }
    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #f1f5f9;
    }
    .stat-item:last-child {
      border-bottom: none;
    }
    .stat-label {
      color: #64748b;
    }
    .stat-value {
      font-weight: 600;
      color: #3b82f6;
    }
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background: #3b82f6;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      font-size: 15px;
      transition: background 0.3s;
      margin-top: auto;
    }
    .btn:hover {
      background: #2563eb;
    }
    .verified-badge {
      display: inline-block;
      background: #10b981;
      color: white;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 12px;
      margin-top: 10px;
      font-weight: 600;
    }
    footer {
      background-color: #1e293b;
      color: #cbd5e1;
      padding: 20px 0;
      font-size: 14px;
      margin-top: auto;
    }
    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 95%;
      max-width: 1400px;
      margin: 0 auto;
    }
    .footer-links {
      display: flex;
      gap: 20px;
    }
    .footer-links a {
      color: #cbd5e1;
      text-decoration: none;
      transition: color 0.3s;
    }
    .footer-links a:hover {
      color: white;
    }
    .copyright {
      text-align: right;
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .modal {
      background: white;
      width: 90%; /* Changed from 80% to 90% */
      max-width: 600px;
      height: 80%;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    .modal-overlay.active .modal {
      transform: scale(1);
    }
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
    }
    .close-modal {
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #94a3b8;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
    }
    .close-modal:hover {
      background: #f1f5f9;
      color: #334155;
    }
    .modal-content {
      flex: 1;
      overflow: auto;
      padding: 20px;
    }
    .cv-container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .cv-header {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #e2e8f0;
    }
    .cv-section {
      margin-bottom: 1.5rem;
    }
    .cv-section h3 {
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid #e2e8f0;
      color: #3b82f6;
    }
    .cv-item {
      margin-bottom: 0.75rem;
      padding-left: 1rem;
      border-left: 3px solid #3b82f6;
    }
    .cv-item h4 {
      margin-bottom: 0.25rem;
      color: #1e293b;
    }
    .cv-item p {
      color: #64748b;
      margin: 0;
    }
    .cv-actions {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      justify-content: center;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: #334155;
      font-size: 14px;
    }
    .form-control {
      width: 100%;
      padding: 10px 14px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', sans-serif;
      background: #f8fafc;
    }
    .form-control:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .form-row {
      display: flex;
      gap: 12px;
    }
    .form-row .form-group {
      flex: 1;
    }
    .modal-footer {
      padding: 20px;
      border-top: 1px solid #e2e8f0;
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }
    .btn-secondary {
      background: #e2e8f0;
      color: #334155;
    }
    .btn-secondary:hover {
      background: #cbd5e1;
    }
    .table-container {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }
    th {
      font-weight: 600;
      color: #1e293b;
      background: #f8fafc;
    }
    tr:hover td {
      background: #f8fafc;
    }
    .status-badge {
      padding: 4px 12px;
      border-radius: 50px;
      font-size: 12px;
      font-weight: 600;
    }
    .status-applied {
      background: #dbeafe;
      color: #1d4ed8;
    }
    .status-accepted {
      background: #dcfce7;
      color: #16a34a;
    }
    .status-rejected {
      background: #fee2e2;
      color: #dc2626;
    }
    .status-pending {
      background: #fef3c7;
      color: #d97706;
    }
    .calendar-modal {
      display: flex;
      height: 100%;
    }
    .calendar-main {
      width: 75%;
      display: flex;
      flex-direction: column;
    }
    .calendar-sidebar {
      width: 25%;
      padding: 20px;
      background: #f8fafc;
      border-left: 1px solid #e2e8f0;
      overflow-y: auto;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }
    .calendar-month-selector {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .calendar-month-selector select {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      background: white;
    }
    .calendar-nav {
      display: flex;
      gap: 8px;
    }
    .calendar-nav button {
      background: #e2e8f0;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .calendar-nav button:hover {
      background: #cbd5e1;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      padding: 16px;
      background: white;
      height: calc(100% - 60px);
      overflow-y: auto;
    }
    .calendar-day {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: #f8fafc;
      font-size: 14px;
      color: #64748b;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      min-height: 60px;
    }
    .calendar-day:hover {
      background: #e2e8f0;
    }
    .calendar-day.today {
      background: #3b82f6;
      color: white;
      font-weight: 600;
    }
    .calendar-day.has-event::after {
      content: '';
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      width: 8px;
      height: 8px;
      background: #3b82f6;
      border-radius: 50%;
    }
    .calendar-day-number {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .sidebar-title {
      font-size: 16px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 16px;
    }
    .sidebar-event {
      padding: 12px;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 12px;
      cursor: pointer;
    }
    .sidebar-event:hover {
      background: #f8fafc;
    }
    .sidebar-event-title {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 4px;
    }
    .sidebar-event-time {
      font-size: 12px;
      color: #64748b;
    }
    .applications-list {
      list-style: none;
      padding: 0;
    }
    .application-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      margin-bottom: 12px;
      background: #f9fafb;
      border-radius: 8px;
      border-left: 4px solid #3b82f6;
      transition: background 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    .application-item:hover {
      background: #f3f4f6;
    }
    .application-info {
      flex: 1;
    }
    .application-title {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 4px;
    }
    .application-org {
      color: #64748b;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .application-date {
      font-size: 12px;
      color: #94a3b8;
    }
    .application-status {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 50px;
      font-size: 12px;
      font-weight: 600;
      margin-right: 12px;
    }
    .btn-view-details {
      background: #3b82f6;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: background 0.2s, transform 0.1s;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .btn-view-details:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }
    .btn-view-details:active {
      transform: translateY(0);
    }
    .update-cv-form {
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
      background: #f8fafc;
      border-radius: 12px;
    }
    .update-cv-form .form-row {
      gap: 12px;
    }
    .update-cv-form .form-group {
      margin: 0;
    }
    .update-cv-form .form-control {
      padding: 8px 12px;
      font-size: 14px;
    }
    .update-cv-form .form-group label {
      font-size: 14px;
      color: #1e40af;
      font-weight: 600;
    }
    .update-cv-form .form-control {
      background: #f8fafc;
    }
    .update-cv-form .form-group textarea {
      min-height: 60px;
      resize: vertical;
    }
    .app-detail-modal {
      background: white;
      width: 90%;
      max-width: 600px;
      height: 80%;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .app-detail-content {
      padding: 20px;
      flex: 1;
      overflow-y: auto;
    }
    .app-detail-title {
      font-size: 20px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 8px;
    }
    .app-detail-org {
      color: #64748b;
      font-size: 14px;
      margin-bottom: 12px;
    }
    .app-detail-section {
      margin-bottom: 20px;
    }
    .app-detail-section h4 {
      font-size: 16px;
      color: #1e293b;
      margin-bottom: 8px;
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 8px;
    }
    .app-detail-text {
      color: #64748b;
      line-height: 1.5;
    }
    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .modal {
        width: 90%;
        max-width: 600px;
        height: 90%;
      }
      .form-row {
        flex-direction: column;
        gap: 0;
      }
    }
    @media (max-width: 768px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      .header-content {
        width: 90%;
      }
      .container {
        width: 90%;
      }
      .cv-container {
        padding: 1.5rem;
        max-width: 100%;
      }
      .calendar-modal {
        flex-direction: column;
      }
      .calendar-main {
        width: 100%;
      }
      .calendar-sidebar {
        width: 100%;
        border-left: none;
        border-top: 1px solid #e2e8f0;
      }
      .applications-list {
        padding: 0 10px;
      }
      .application-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .application-actions {
        width: 100%;
        justify-content: flex-start;
      }
      .btn-view-details {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <!-- ‚úÖ CHANGED: Logo now links to dashboard -->
      <a href="student-dashboard.html" class="logo">Stud<span>evo</span></a>
      <div class="user-menu">
        <!-- REPLACED NOTIFICATION BELL -->
        <div class="notification-bell" id="notificationBell">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          <span class="notification-badge" id="notificationBadge">0</span>
        </div>
        <button class="header-btn" title="Profile">üë§</button>
        <button class="header-btn" title="Settings">‚öôÔ∏è</button>
        <button class="logout-btn" onclick="logout()">Log Out</button>
      </div>
    </div>
  </header>
  <main class="container">
    <div class="dashboard-header">
      <h1>Student Dashboard</h1>
      <p>Welcome back! Manage your applications, CV, and opportunities.</p>
    </div>
    <div class="dashboard-grid">
      <div class="action-card">
        <div class="card-icon">üìÑ</div>
        <h3>CV Profile</h3>
        <p>View and edit your professional CV and portfolio.</p>
        <div style="display: flex; gap: 10px; justify-content: center; width: 100%;">
          <a href="#" class="btn" id="openCvModal">View CV</a>
          <a href="#" class="btn" id="openUpdateCvModal">Update CV</a>
        </div>
      </div>
      <div class="action-card">
        <div class="card-icon">üìã</div>
        <h3>My Applications</h3>
        <p>Track your application status and manage submissions.</p>
        <a href="#" class="btn" id="openApplicationsModal">View Applications</a>
      </div>
      <div class="action-card">
        <div class="card-icon">üîç</div>
        <h3>Browse Opportunities</h3>
        <p>Find volunteering, jobs, and activities to enhance your portfolio.</p>
        <a href="browse-opportunities.html" class="btn">Browse Opportunities</a>
      </div>
      <div class="action-card">
        <div class="card-icon">üìä</div>
        <h3>Quick Stats</h3>
        <div class="stats-overview">
          <div class="stat-item">
            <span class="stat-label">Applied:</span>
            <span class="stat-value">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Accepted:</span>
            <span class="stat-value">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Rejected:</span>
            <span class="stat-value">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Pending:</span>
            <span class="stat-value">0</span>
          </div>
        </div>
      </div>
      <div class="action-card">
        <div class="card-icon">üìÖ</div>
        <h3>Calendar</h3>
        <p>View upcoming deadlines, interviews, and events.</p>
        <a href="#" class="btn" id="openCalendarModal">View Calendar</a>
        <div class="verified-badge" style="background: #3b82f6; margin-top: 15px;">0 Upcoming Events</div>
      </div>
      <div class="action-card">
        <div class="card-icon">‚úÖ</div>
        <h3>Profile Completion</h3>
        <p>Complete your profile to increase your chances of acceptance.</p>
        <div style="margin: 20px 0;">
          <div style="width: 100%; height: 10px; background: #e2e8f0; border-radius: 5px; margin-bottom: 10px;">
            <div id="profileProgress" style="width: 0%; height: 100%; background: #3b82f6; border-radius: 5px;"></div>
          </div>
          <div id="profilePercent" style="text-align: center; color: #64748b;">0% Complete</div>
        </div>
        <a href="#" class="btn">Complete Profile</a>
      </div>
    </div>
  </main>
  <footer>
    <div class="footer-content">
      <!-- ‚úÖ CHANGED: Footer logo now links to dashboard -->
      <div class="footer-brand">
        <a href="student-dashboard.html" class="logo" style="color: white; font-size: 20px; text-decoration: none;">Stud<span>evo</span></a>
      </div>
      <div class="footer-links">
        <a href="#contact">Contact</a>
        <a href="#privacy">Privacy Policy</a>
        <a href="#" id="helpSupport">Help & Support</a>
      </div>
      <div class="copyright">
        &copy; 2025 Studevo. All rights reserved.
      </div>
    </div>
  </footer>
  <!-- CV View Modal -->
  <div class="modal-overlay" id="cvModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">My CV</h2>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-content">
        <div class="cv-container">
          <div class="cv-header">
            <h2 id="cvName">Your CV</h2>
            <p id="cvStatus" style="color: #64748b; margin-top: 0.5rem;">Loading...</p>
          </div>
          <div id="cvContent" class="cv-section">
            <!-- Filled by JS -->
          </div>
          <div class="cv-actions">
            <button class="btn btn-primary" id="downloadCvBtn" disabled>
              <i class="fas fa-download"></i> Download CV
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Update CV Modal -->
  <div class="modal-overlay" id="editCvModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Update CV</h2>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-content">
        <form id="editCvForm" class="update-cv-form">
          <div class="form-row">
            <div class="form-group">
              <label for="firstName">First Name</label>
              <input type="text" id="firstName" class="form-control" required>
            </div>
            <div class="form-group">
              <label for="lastName">Last Name</label>
              <input type="text" id="lastName" class="form-control" required>
            </div>
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="phone">Phone</label>
            <input type="tel" id="phone" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="address">Address</label>
            <input type="text" id="address" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="education">Education</label>
            <textarea id="education" class="form-control" rows="4" required></textarea>
          </div>
          <div class="form-group">
            <label for="skills">Skills</label>
            <textarea id="skills" class="form-control" rows="3" required></textarea>
          </div>
          <div class="form-group">
            <label for="experience">Experience</label>
            <textarea id="experience" class="form-control" rows="3" required></textarea>
          </div>
          <div class="form-group">
            <label for="projects">Projects</label>
            <textarea id="projects" class="form-control" rows="3" required></textarea>
          </div>
          <div class="form-group">
            <label for="certifications">Certifications</label>
            <textarea id="certifications" class="form-control" rows="2" required></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
      </div>
    </div>
  </div>
  <!-- Calendar Modal -->
  <div class="modal-overlay" id="calendarModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Calendar</h2>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-content">
        <div class="calendar-modal">
          <div class="calendar-main">
            <div class="calendar-header">
              <div class="calendar-month-selector">
                <select id="monthSelector">
                  <option value="0">January</option>
                  <option value="1">February</option>
                  <option value="2">March</option>
                  <option value="3">April</option>
                  <option value="4">May</option>
                  <option value="5" selected>June</option>
                  <option value="6">July</option>
                  <option value="7">August</option>
                  <option value="8">September</option>
                  <option value="9">October</option>
                  <option value="10">November</option>
                  <option value="11">December</option>
                </select>
                <select id="yearSelector">
                  <option>2023</option>
                  <option selected>2025</option>
                  <option>2026</option>
                </select>
              </div>
              <div class="calendar-nav">
                <button id="prevMonth"><</button>
                <button id="nextMonth">></button>
              </div>
            </div>
            <div class="calendar-grid" id="calendarGrid">
              <!-- Generated by JS -->
            </div>
          </div>
          <div class="calendar-sidebar">
            <h3 class="sidebar-title">Upcoming Events</h3>
            <p style="color: #64748b; padding: 12px;">No upcoming events.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Applications Modal -->
  <div class="modal-overlay" id="applicationsModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">My Applications</h2>
        <button class="close-modal">&times;</button>
      </div>
      <div class="modal-content">
        <ul class="applications-list">
          <li style="text-align: center; padding: 20px; color: #64748b;">
            You haven't applied to any opportunities yet.
          </li>
        </ul>
      </div>
    </div>
  </div>
  <!-- Application Detail Modal -->
  <div class="modal-overlay" id="appDetailModal">
    <div class="app-detail-modal">
      <div class="modal-header">
        <h2 class="modal-title">Application Details</h2>
        <button class="close-modal">&times;</button>
      </div>
      <div class="app-detail-content">
        <div class="app-detail-title" id="detailTitle">‚Äî</div>
        <div class="app-detail-org" id="detailOrg">‚Äî</div>
        <div class="app-detail-section">
          <h4>Application Status</h4>
          <div class="app-detail-text" id="detailStatus">‚Äî</div>
        </div>
        <div class="app-detail-section">
          <h4>Submitted On</h4>
          <div class="app-detail-text" id="detailDate">‚Äî</div>
        </div>
        <div class="app-detail-section">
          <h4>Description</h4>
          <div class="app-detail-text" id="detailDesc">‚Äî</div>
        </div>
        <div class="app-detail-section">
          <h4>Requirements</h4>
          <div class="app-detail-text" id="detailReqs">‚Äî</div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function logout() {
      localStorage.clear();
      window.location.href = 'index.html';
    }
    // ===== PROFILE COMPLETION CALCULATION =====
    function updateProfileCompletion(cvData) {
      if (!cvData) return;
      const fields = [
        cvData.firstName, cvData.lastName, cvData.email, cvData.phone,
        cvData.address, cvData.education, cvData.skills, cvData.experience,
        cvData.projects, cvData.certifications
      ];
      const filled = fields.filter(f => f && f.trim().length > 0).length;
      const total = fields.length;
      const percent = Math.round((filled / total) * 100);
      document.getElementById('profileProgress').style.width = `${percent}%`;
      document.getElementById('profilePercent').textContent = `${percent}% Complete`;
      // Also update card badge
      const badge = document.querySelector('.action-card:nth-child(6) .verified-badge');
      if (badge) {
        badge.textContent = `${percent}% Complete`;
        badge.style.background = percent >= 80 ? '#10b981' : '#3b82f6';
      }
    }
    // ===== ‚úÖ DEMO FIX: SAVE TO LOCALSTORAGE =====
    async function saveCvToBackend(data) {
      localStorage.setItem('studentCvData', JSON.stringify(data));
      showCustomPopup('‚úÖ CV updated successfully!');
      return data;
    }
    async function loadCvFromBackend() {
      const data = localStorage.getItem('studentCvData');
      return data ? JSON.parse(data) : null;
    }
    // ===== MODAL MANAGEMENT =====
    const cvModal = document.getElementById('cvModal');
    const editCvModal = document.getElementById('editCvModal');
    const calendarModal = document.getElementById('calendarModal');
    const applicationsModal = document.getElementById('applicationsModal');
    const appDetailModal = document.getElementById('appDetailModal');
    function closeModal(modal) {
      modal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }
    // ===== OPEN "Update CV" MODAL ‚Äî pre-fill if data exists =====
    document.getElementById('openUpdateCvModal').addEventListener('click', async e => {
  e.preventDefault();
  const cvData = await loadCvFromBackend();
  const form = document.getElementById('editCvForm');

  if (cvData) {
    form.firstName.value = cvData.firstName || user.firstName || '';
    form.lastName.value = cvData.lastName || user.lastName || '';
    form.email.value = cvData.email || user.email || '';
    form.phone.value = cvData.phone || user.phone || '';
    form.address.value = cvData.address || '';
    form.education.value = cvData.education || '';
    form.skills.value = cvData.skills || '';
    form.experience.value = cvData.experience || '';
    form.projects.value = cvData.projects || '';
    form.certifications.value = cvData.certifications || '';
  } else {
    form.reset();
    // ‚úÖ Pre-fill from logged-in user
    form.firstName.value = user.firstName || '';
    form.lastName.value = user.lastName || '';
    form.email.value = user.email || '';
    form.phone.value = user.phone || ''; // üëà Critical!
  }
  editCvModal.classList.add('active');
  document.body.style.overflow = 'hidden';
});
    // ===== OPEN "View CV" MODAL ‚Äî show saved data =====
    document.getElementById('openCvModal').addEventListener('click', async e => {
      e.preventDefault();
      const cvData = await loadCvFromBackend();
      const cvName = document.getElementById('cvName');
      const cvStatus = document.getElementById('cvStatus');
      const cvContent = document.getElementById('cvContent');
      const downloadBtn = document.getElementById('downloadCvBtn');
      if (cvData) {
        cvName.textContent = `${cvData.firstName} ${cvData.lastName}`;
       cvStatus.innerHTML = `
  <strong>Email:</strong> ${cvData.email}<br>
  <strong>Phone:</strong> ${cvData.phone}<br>
  <strong>Address:</strong> ${cvData.address}<br><br>
  <strong>Education:</strong><br>${cvData.education.replace(/\n/g, '<br>')}<br><br>
  <strong>Skills:</strong><br>${cvData.skills.replace(/\n/g, '<br>')}<br><br>
  <strong>Experience:</strong><br>${cvData.experience.replace(/\n/g, '<br>')}<br><br>
  <strong>Projects:</strong><br>${cvData.projects.replace(/\n/g, '<br>')}<br><br>
  <strong>Certifications:</strong><br>${cvData.certifications.replace(/\n/g, '<br>')}
`;
        downloadBtn.disabled = false;
        updateProfileCompletion(cvData);
      } else {
        cvName.textContent = 'Your CV';
        cvStatus.innerHTML = 'No CV data available. Please update your profile first.';
        cvContent.innerHTML = '';
        downloadBtn.disabled = true;
        updateProfileCompletion(null);
      }
      cvModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    });
    // ===== CLOSE MODALS =====
    document.querySelectorAll('.close-modal').forEach(btn => {
      btn.addEventListener('click', () => {
        const modal = btn.closest('.modal-overlay');
        closeModal(modal);
      });
    });
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', e => {
        if (e.target === overlay) closeModal(overlay);
      });
    });
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        const active = document.querySelector('.modal-overlay.active');
        if (active) closeModal(active);
      }
    });
    // ===== SAVE CV FORM =====
    // ===== SAVE CV FORM =====
document.getElementById('editCvForm').addEventListener('submit', async e => {
  e.preventDefault();

  // ‚úÖ Get values directly to avoid empty strings
  const firstName = document.getElementById('firstName').value.trim();
  const lastName = document.getElementById('lastName').value.trim();
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const address = document.getElementById('address').value.trim();
  const education = document.getElementById('education').value.trim();
  const skills = document.getElementById('skills').value.trim();
  const experience = document.getElementById('experience').value.trim();
  const projects = document.getElementById('projects').value.trim();
  const certifications = document.getElementById('certifications').value.trim();

  // ‚úÖ Validate required fields
  if (!firstName || !lastName || !email || !phone) {
    showCustomPopup('‚ùå Please fill in all required fields: First Name, Last Name, Email, and Phone.');
    return;
  }

  const cvData = {
    email, // needed for backend lookup
    firstName,
    lastName,
    phone,
    address,
    education,
    skills,
    experience,
    projects,
    certifications
  };

  try {
    await saveCvToBackend(cvData);
    closeModal(editCvModal);
    const freshData = await loadCvFromBackend();
    if (freshData) updateProfileCompletion(freshData);
  } catch (err) {
    // Error shown in saveCvToBackend
  }
});
    // ===== CUSTOM POPUP FUNCTION (replaces alert) =====
    function showCustomPopup(message) {
      // Create popup if not exists
      let popup = document.getElementById('customPopup');
      if (!popup) {
        popup = document.createElement('div');
        popup.id = 'customPopup';
        popup.style.cssText = `
          position: fixed;
          bottom: 20px;
          right: 20px;
          background: #3b82f6;
          color: white;
          padding: 14px 24px;
          border-radius: 12px;
          font-weight: 600;
          font-size: 16px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.2);
          z-index: 9999;
          opacity: 0;
          transform: translateY(20px);
          transition: opacity 0.3s, transform 0.3s;
        `;
        document.body.appendChild(popup);
      }
      popup.textContent = message;
      popup.style.opacity = '1';
      popup.style.transform = 'translateY(0)';
      setTimeout(() => {
        popup.style.opacity = '0';
        popup.style.transform = 'translateY(20px)';
      }, 2500);
    }
    // ===== OTHER BUTTONS =====
    document.getElementById('helpSupport').addEventListener('click', function(e) {
      e.preventDefault();
      alert('Help & Support section would open here with tutorials, FAQ, and contact options.');
    });
    document.getElementById('downloadCvBtn').addEventListener('click', () => {
      alert('CV download functionality would be implemented here.');
    });
    document.getElementById('notificationBell').addEventListener('click', e => {
      e.preventDefault();
      alert('Notifications will appear here when implemented.');
    });
    document.getElementById('openCalendarModal').addEventListener('click', e => {
      e.preventDefault();
      calendarModal.classList.add('active');
      document.body.style.overflow = 'hidden';
      generateCalendar();
    });
    document.getElementById('openApplicationsModal').addEventListener('click', e => {
      e.preventDefault();
      applicationsModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    });
    // ===== CALENDAR =====
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    function generateCalendar() {
      const monthSelect = document.getElementById('monthSelector');
      const yearSelect = document.getElementById('yearSelector');
      const calendarGrid = document.getElementById('calendarGrid');
      currentMonth = parseInt(monthSelect.value);
      currentYear = parseInt(yearSelect.value);
      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      calendarGrid.innerHTML = '';
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      days.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-day';
        dayHeader.textContent = day;
        dayHeader.style.fontWeight = '600';
        dayHeader.style.color = '#1e293b';
        dayHeader.style.backgroundColor = '#f8fafc';
        dayHeader.style.border = 'none';
        calendarGrid.appendChild(dayHeader);
      });
      for (let i = 0; i < firstDay; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day';
        emptyCell.style.backgroundColor = 'transparent';
        emptyCell.style.border = 'none';
        calendarGrid.appendChild(emptyCell);
      }
      for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement('div');
        dayCell.className = 'calendar-day';
        dayCell.innerHTML = `<span class="calendar-day-number">${day}</span>`;
        const today = new Date();
        if (currentYear === today.getFullYear() && currentMonth === today.getMonth() && day === today.getDate()) {
          dayCell.classList.add('today');
        }
        dayCell.addEventListener('click', function() {
          alert(`You clicked day ${day} of ${monthSelect.options[monthSelect.selectedIndex].text} ${currentYear}.`);
        });
        calendarGrid.appendChild(dayCell);
      }
      const totalCells = 42;
      const filledCells = firstDay + daysInMonth;
      for (let i = filledCells; i < totalCells; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day';
        emptyCell.style.backgroundColor = 'transparent';
        emptyCell.style.border = 'none';
        calendarGrid.appendChild(emptyCell);
      }
    }
    document.getElementById('prevMonth').addEventListener('click', function() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      document.getElementById('monthSelector').value = currentMonth;
      document.getElementById('yearSelector').value = currentYear;
      generateCalendar();
    });
    document.getElementById('nextMonth').addEventListener('click', function() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      document.getElementById('monthSelector').value = currentMonth;
      document.getElementById('yearSelector').value = currentYear;
      generateCalendar();
    });
    document.getElementById('monthSelector').addEventListener('change', generateCalendar);
    document.getElementById('yearSelector').addEventListener('change', generateCalendar);
    function showApplicationDetails(id) {
      // placeholder
    }
  </script>
</body>
</html>