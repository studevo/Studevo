<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Student Dashboard ‚Äî Studevo</title>
  <style>
    /* ... (your exact CSS from previous full version) ... */
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }
    body { 
      font-family: 'Segoe UI', sans-serif; 
      background: #f8fafc; 
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .container { 
      width: 95%;
      max-width: 1400px; 
      margin: 0 auto; 
      padding: 20px;
      flex: 1;
    }
    header { 
      background: white; 
      padding: 15px 0; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
    }
    .header-content { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      width: 95%;
      max-width: 1400px; 
      margin: 0 auto; 
    }
    .logo { 
      font-size: 24px; 
      font-weight: 800; 
      color: #3b82f6; 
      text-decoration: none;
    }
    .logo span { 
      color: #1e40af; 
    }
    .user-menu { 
      display: flex; 
      align-items: center; 
      gap: 15px; 
    }
    .header-btn {
      background: #3b82f6;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
      position: relative;
      font-size: 18px;
    }
    .header-btn:hover {
      background: #2563eb;
    }
    .logout-btn {
      background: #ef4444;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      font-weight: 600;
    }
    .logout-btn:hover {
      background: #dc2626;
    }
    .notification-bell {
      position: relative;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f8fafc;
      color: #64748b;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .notification-bell:hover,
    .notification-bell.active {
      background: #dbeafe;
      color: #3b82f6;
    }
    .notification-bell svg {
      width: 20px;
      height: 20px;
      stroke: currentColor;
    }
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ef4444;
      color: white;
      font-size: 10px;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    .dashboard-header { 
      text-align: center; 
      margin-bottom: 40px; 
    }
    .dashboard-header h1 { 
      font-size: 32px; 
      color: #1e293b; 
      margin-bottom: 10px; 
    }
    .dashboard-header p { 
      color: #64748b; 
    }
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 30px;
      flex: 1;
      margin-bottom: 40px;
    }
    @media (max-width: 1200px) {
      .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 768px) {
      .dashboard-grid { grid-template-columns: 1fr; }
    }
    .action-card {
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.05);
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
    }
    .action-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(59, 130, 246, 0.2);
    }
    .card-icon {
      font-size: 40px;
      margin-bottom: 20px;
      color: #3b82f6;
    }
    .action-card h3 {
      margin-bottom: 15px;
      color: #1e293b;
      font-size: 20px;
    }
    .action-card p {
      color: #64748b;
      margin-bottom: 20px;
      font-size: 15px;
      line-height: 1.5;
      flex: 1;
    }
    .stats-overview {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin: 20px 0;
      flex: 1;
    }
    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #f1f5f9;
    }
    .stat-item:last-child {
      border-bottom: none;
    }
    .stat-label {
      color: #64748b;
    }
    .stat-value {
      font-weight: 600;
      color: #3b82f6;
    }
    .btn {
      display: inline-block;
      padding: 10px 20px;
      background: #3b82f6;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      font-size: 15px;
      transition: background 0.3s;
      margin-top: auto;
    }
    .btn:hover {
      background: #2563eb;
    }
    .verified-badge {
      display: inline-block;
      background: #10b981;
      color: white;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 12px;
      margin-top: 10px;
      font-weight: 600;
    }
    footer {
      background-color: #1e293b;
      color: #cbd5e1;
      padding: 20px 0;
      font-size: 14px;
      margin-top: auto;
    }
    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 95%;
      max-width: 1400px;
      margin: 0 auto;
    }
    .footer-links {
      display: flex;
      gap: 20px;
    }
    .footer-links a {
      color: #cbd5e1;
      text-decoration: none;
      transition: color 0.3s;
    }
    .footer-links a:hover {
      color: white;
    }
    .copyright {
      text-align: right;
    }

    /* === MODAL OVERLAY (SHARED) === */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* === UNIFIED MODAL DESIGN (FOR CV MODALS) === */
    .cv-modal {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      max-width: 700px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .cv-modal-header {
      background: linear-gradient(135deg, #3b5998 0%, #2d4373 100%);
      color: white;
      padding: 30px 40px;
      border-radius: 16px 16px 0 0;
      position: relative;
    }

    .cv-modal-title {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .cv-modal-subtitle {
      font-size: 14px;
      opacity: 0.9;
    }

    .close-modal {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }

    .close-modal:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .cv-modal-content {
      padding: 40px;
    }

    /* === VIEW CV STYLES === */
    .profile-section {
      text-align: center;
      margin-bottom: 35px;
      padding-bottom: 35px;
      border-bottom: 2px solid #f0f0f0;
    }

    .profile-name {
      font-size: 32px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 20px;
    }

    .contact-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .contact-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: #f7fafc;
      border-radius: 8px;
      font-size: 14px;
      color: #4a5568;
    }

    .contact-icon {
      width: 20px;
      height: 20px;
      color: #3b5998;
    }

    .section {
      margin-bottom: 30px;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
      padding-bottom: 12px;
      border-bottom: 2px solid #e2e8f0;
    }

    .section-icon {
      width: 24px;
      height: 24px;
      color: #3b5998;
    }

    .section-title {
      font-size: 20px;
      font-weight: 600;
      color: #2d3748;
    }

    .section-content {
      padding-left: 36px;
      color: #718096;
      line-height: 1.8;
    }

    .empty-state {
      color: #a0aec0;
      font-style: italic;
      font-size: 14px;
    }

    /* === UPDATE CV FORM STYLES === */
    .form-section {
      margin-bottom: 30px;
    }

    .form-row {
      display: flex;
      gap: 20px;
    }

    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: 16px;
      }
    }

    .form-group {
      margin-bottom: 20px;
      flex: 1;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2d3748;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-label.required::after {
      content: "*";
      color: #e53e3e;
      font-weight: bold;
    }

    .form-control {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 15px;
      background: white;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-control:focus {
      outline: none;
      border-color: #3b5998;
      box-shadow: 0 0 0 3px rgba(59, 89, 152, 0.1);
    }

    .form-control::placeholder {
      color: #a0aec0;
    }

    textarea.form-control {
      min-height: 80px;
      resize: vertical;
    }

    .form-actions {
      display: flex;
      gap: 16px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid #f0f0f0;
    }

    .btn-primary {
      background: #3b5998;
      color: white;
      border: none;
      padding: 12px 28px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .btn-primary:hover {
      background: #2d4373;
    }

    .btn-secondary {
      background: #e2e8f0;
      color: #4a5568;
      border: none;
      padding: 12px 28px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .btn-secondary:hover {
      background: #cbd5e1;
    }

    /* === PROFILE COMPLETION === */
    #profileProgress {
      width: 100%;
      height: 10px;
      background: #e2e8f0;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    #profileProgress > div {
      height: 100%;
      background: #3b82f6;
      border-radius: 5px;
    }

    /* === OTHER MODALS (Applications, Calendar) === */
    .generic-modal {
      background: white;
      width: 90%;
      max-width: 600px;
      height: 80%;
      border-radius: 16px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      transform: scale(0.9);
      transition: transform 0.3s ease;
    }
    .modal-overlay.active .generic-modal {
      transform: scale(1);
    }
    .generic-modal-header {
      padding: 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .generic-modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #1e293b;
    }
    .generic-modal-content {
      flex: 1;
      overflow: auto;
      padding: 20px;
    }

    /* === CALENDAR STYLES === */
    .calendar-modal {
      display: flex;
      height: 100%;
    }
    .calendar-main {
      width: 95%;
      display: flex;
      flex-direction: column;
    }
    .calendar-sidebar {
      width: 25%;
      padding: 20px;
      background: #f8fafc;
      border-left: 1px solid #e2e8f0;
      overflow-y: auto;
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: #f8fafc;
      border-bottom: 1px solid #e2e8f0;
    }
    .calendar-month-selector {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .calendar-month-selector select {
      padding: 8px 12px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 14px;
      background: white;
    }
    .calendar-nav {
      display: flex;
      gap: 8px;
    }
    .calendar-nav button {
      background: #e2e8f0;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.2s;
    }
    .calendar-nav button:hover {
      background: #cbd5e1;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      padding: 16px;
      background: white;
      height: calc(100% - 60px);
      overflow-y: auto;
    }
    .calendar-day {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      background: #f8fafc;
      font-size: 14px;
      color: #64748b;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      min-height: 60px;
    }
    .calendar-day:hover {
      background: #e2e8f0;
    }
    .calendar-day.today {
      background: #3b82f6;
      color: white;
      font-weight: 600;
    }
    .calendar-day.has-event::after {
      content: '';
      position: absolute;
      bottom: 4px;
      left: 50%;
      transform: translateX(-50%);
      width: 8px;
      height: 8px;
      background: #3b82f6;
      border-radius: 50%;
    }
    .calendar-day-number {
      font-weight: 600;
      margin-bottom: 4px;
    }
    .sidebar-title {
      font-size: 16px;
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 16px;
    }
    .sidebar-event {
      padding: 12px;
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 12px;
      cursor: pointer;
    }
    .sidebar-event:hover {
      background: #f8fafc;
    }
    .sidebar-event-title {
      font-weight: 600;
      color: #1e293b;
      margin-bottom: 4px;
    }
    .sidebar-event-time {
      font-size: 12px;
      color: #64748b;
    }

    /* === CUSTOM POPUP === */
    #customPopup {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #3b82f6;
      color: white;
      padding: 14px 24px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      z-index: 9999;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.3s, transform 0.3s;
    }
  </style>
</head>
<body>
  <!-- ... (your exact HTML structure for header, dashboard, modals) ... -->
  <header>
    <div class="header-content">
      <a href="student-dashboard.html" class="logo">Stud<span>evo</span></a>
      <div class="user-menu">
        <div class="notification-bell" id="notificationBell">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
          </svg>
          <span class="notification-badge" id="notificationBadge">0</span>
        </div>
        <button class="header-btn" title="Profile">üë§</button>
        <button class="header-btn" title="Settings">‚öôÔ∏è</button>
        <button class="logout-btn" id="logoutBtn">Log Out</button>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="dashboard-header">
      <h1>Student Dashboard</h1>
      <p>Welcome back! Manage your applications, CV, and opportunities.</p>
    </div>
    <div class="dashboard-grid">
      <div class="action-card">
        <div class="card-icon">üìÑ</div>
        <h3>CV Profile</h3>
        <p>View and edit your professional CV and portfolio.</p>
        <div style="display: flex; gap: 10px; justify-content: center; width: 100%;">
          <button class="btn" id="openCvModal">View CV</button>
          <button class="btn" id="openUpdateCvModal">Update CV</button>
        </div>
      </div>
      <div class="action-card">
        <div class="card-icon">üìã</div>
        <h3>My Applications</h3>
        <p>Track your application status and manage submissions.</p>
        <button class="btn" id="openApplicationsModal">View Applications</button>
      </div>
      <div class="action-card">
        <div class="card-icon">üîç</div>
        <h3>Browse Opportunities</h3>
        <p>Find volunteering, jobs, and activities to enhance your portfolio.</p>
        <a href="browse-opportunities.html" class="btn">Browse Opportunities</a>
      </div>
      <div class="action-card">
        <div class="card-icon">üìä</div>
        <h3>Quick Stats</h3>
        <div class="stats-overview">
          <div class="stat-item">
            <span class="stat-label">Applied:</span>
            <span class="stat-value">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Accepted:</span>
            <span class="stat-value">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Rejected:</span>
            <span class="stat-value">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Pending:</span>
            <span class="stat-value">0</span>
          </div>
        </div>
      </div>
      <div class="action-card">
        <div class="card-icon">üìÖ</div>
        <h3>Calendar</h3>
        <p>View upcoming deadlines, interviews, and events.</p>
        <button class="btn" id="openCalendarModal">View Calendar</button>
        <div class="verified-badge" style="background: #3b82f6; margin-top: 15px;">0 Upcoming Events</div>
      </div>
      <div class="action-card">
        <div class="card-icon">‚úÖ</div>
        <h3>Profile Completion</h3>
        <p>Complete your profile to increase your chances of acceptance.</p>
        <div style="margin: 20px 0;">
          <div id="profileProgress"><div style="width: 0%;"></div></div>
          <div id="profilePercent" style="text-align: center; color: #64748b;">0% Complete</div>
        </div>
        <button class="btn">Complete Profile</button>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-brand">
        <a href="student-dashboard.html" class="logo" style="color: white; text-decoration: none;">Stud<span>evo</span></a>
      </div>
      <div class="footer-links">
        <a href="#contact">Contact</a>
        <a href="#privacy">Privacy Policy</a>
        <a href="#" id="helpSupport">Help & Support</a>
      </div>
      <div class="copyright">
        &copy; 2025 Studevo. All rights reserved.
      </div>
    </div>
  </footer>

  <!-- View CV Modal -->
  <div class="modal-overlay" id="cvModal">
    <div class="cv-modal">
      <div class="cv-modal-header">
        <button class="close-modal">&times;</button>
        <div class="cv-modal-title">My CV</div>
        <div class="cv-modal-subtitle">Professional Profile</div>
      </div>
      <div class="cv-modal-content" id="cvContent">
        <div style="padding: 20px; text-align: center; color: #64748b;">
          Loading CV...
        </div>
      </div>
    </div>
  </div>

  <!-- Update CV Modal -->
  <div class="modal-overlay" id="editCvModal">
    <div class="cv-modal">
      <div class="cv-modal-header">
        <button class="close-modal">&times;</button>
        <div class="cv-modal-title">Update CV</div>
        <div class="cv-modal-subtitle">Edit your professional details</div>
      </div>
      <div class="cv-modal-content">
        <form id="editCvForm">
          <div class="form-section">
            <div class="section-header">
              <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
              <h2 class="section-title">Personal Information</h2>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label required">First Name</label>
                <input type="text" id="firstName" class="form-control" required>
              </div>
              <div class="form-group">
                <label class="form-label required">Last Name</label>
                <input type="text" id="lastName" class="form-control" required>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label class="form-label required">Email</label>
                <input type="email" id="email" class="form-control" required>
              </div>
              <div class="form-group">
                <label class="form-label required">Phone</label>
                <input type="tel" id="phone" class="form-control" required>
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Address</label>
              <input type="text" id="address" class="form-control">
            </div>
          </div>

          <div class="form-section">
            <div class="section-header">
              <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
              </svg>
              <h2 class="section-title">Education</h2>
            </div>
            <div class="form-group">
              <textarea id="education" class="form-control" placeholder="e.g., Bachelor's in Computer Science, XYZ University (2020-2024)"></textarea>
            </div>
          </div>

          <div class="form-section">
            <div class="section-header">
              <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
              </svg>
              <h2 class="section-title">Skills</h2>
            </div>
            <div class="form-group">
              <textarea id="skills" class="form-control" placeholder="e.g., JavaScript, Python, UI/UX Design"></textarea>
            </div>
          </div>

          <div class="form-section">
            <div class="section-header">
              <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9 1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              <h2 class="section-title">Experience</h2>
            </div>
            <div class="form-group">
              <textarea id="experience" class="form-control" placeholder="e.g., Software Intern, ABC Corp (Summer 2023)"></textarea>
            </div>
          </div>

          <div class="form-section">
            <div class="section-header">
              <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M16 4v12m0 0l-4-4m4 4l4-4"/>
              </svg>
              <h2 class="section-title">Projects</h2>
            </div>
            <div class="form-group">
              <textarea id="projects" class="form-control" placeholder="e.g., E-commerce Website - Built with React & Node.js"></textarea>
            </div>
          </div>

          <div class="form-section">
            <div class="section-header">
              <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <h2 class="section-title">Certifications</h2>
            </div>
            <div class="form-group">
              <textarea id="certifications" class="form-control" placeholder="e.g., Google UX Design Certificate (2023)"></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn-primary">Save CV</button>
            <button type="button" class="btn-secondary" id="cancelCvEdit">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Applications Modal -->
  <div class="modal-overlay" id="applicationsModal">
    <div class="generic-modal">
      <div class="generic-modal-header">
        <h2 class="generic-modal-title">My Applications</h2>
        <button class="close-modal">&times;</button>
      </div>
      <div class="generic-modal-content">
        <p style="text-align: center; padding: 20px; color: #64748b;">
          You haven't applied to any opportunities yet.
        </p>
      </div>
    </div>
  </div>

  <!-- Calendar Modal -->
  <div class="modal-overlay" id="calendarModal">
    <div class="generic-modal">
      <div class="generic-modal-header">
        <h2 class="generic-modal-title">Calendar</h2>
        <button class="close-modal">&times;</button>
      </div>
      <div class="generic-modal-content">
        <div class="calendar-modal">
          <div class="calendar-main">
            <div class="calendar-header">
              <div class="calendar-month-selector">
                <select id="monthSelector">
                  <option value="0">January</option>
                  <option value="1">February</option>
                  <option value="2">March</option>
                  <option value="3">April</option>
                  <option value="4">May</option>
                  <option value="5" selected>June</option>
                  <option value="6">July</option>
                  <option value="7">August</option>
                  <option value="8">September</option>
                  <option value="9">October</option>
                  <option value="10">November</option>
                  <option value="11">December</option>
                </select>
                <select id="yearSelector">
                  <option>2023</option>
                  <option selected>2025</option>
                  <option>2026</option>
                </select>
              </div>
              <div class="calendar-nav">
                <button id="prevMonth"><</button>
                <button id="nextMonth">></button>
              </div>
            </div>
            <div class="calendar-grid" id="calendarGrid">
              <!-- Generated by JS -->
            </div>
          </div>
          <div class="calendar-sidebar">
            <h3 class="sidebar-title">Upcoming Events</h3>
            <p style="color: #64748b; padding: 12px;">No upcoming events.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="customPopup"></div>

  <script>
    // ‚úÖ Auth check
    let user = null;
    try {
      const raw = localStorage.getItem('studyconnectUser');
      if (raw) user = JSON.parse(raw);
    } catch (e) {
      console.warn('Invalid user data in localStorage');
    }

    if (!user || !user.isLoggedIn || user.role !== 'student') {
      alert('Please log in to access the dashboard.');
      window.location.href = 'index.html';
    }

    // ‚úÖ Show popup
    function showCustomPopup(message) {
      const popup = document.getElementById('customPopup');
      popup.textContent = message;
      popup.style.opacity = '1';
      popup.style.transform = 'translateY(0)';
      setTimeout(() => {
        popup.style.opacity = '0';
        popup.style.transform = 'translateY(20px)';
      }, 2500);
    }

    // ‚úÖ Save CV to backend - FIXED WITH DEBUGGING
    async function saveCvToBackend(data) {
      try {
        console.log('Sending CV data to backend:', data);
        const response = await fetch('/api/cv', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        console.log('Backend response:', result);
        
        if (response.ok) {
          showCustomPopup('‚úÖ CV saved successfully!');
          return result;
        } else {
          showCustomPopup(`‚ùå Save failed: ${result.error || 'Unknown error'}`);
          return null;
        }
      } catch (error) {
        console.error('Save CV error:', error);
        showCustomPopup('‚ùå Network error. Check if backend is running on port 5000.');
        return null;
      }
    }

    // ‚úÖ Load CV from backend - FIXED WITH DEBUGGING
    async function loadCvFromBackend() {
      try {
        console.log('Loading CV for email:', user.email);
        const response = await fetch(`/api/cv?email=${encodeURIComponent(user.email)}`);
        
        const result = await response.json();
        console.log('CV Load response:', result);
        
        if (response.ok) {
          // Backend should return { cv: { ... } }
          return result.cv || result; // Handle both formats
        } else {
          showCustomPopup(`‚ùå Load failed: ${result.error || 'CV not found'}`);
          return null;
        }
      } catch (error) {
        console.error('Load CV error:', error);
        showCustomPopup('‚ùå Network error. Check if backend is running.');
        return null;
      }
    }

    // ‚úÖ Profile completion (10 fields)
    function updateProfileCompletion(cvData) {
      if (!cvData) {
        document.querySelector('#profileProgress > div').style.width = '0%';
        document.getElementById('profilePercent').textContent = '0% Complete';
        return;
      }
      const fields = [
        cvData.firstName, cvData.lastName, cvData.email, cvData.phone,
        cvData.address, cvData.education, cvData.skills,
        cvData.experience, cvData.projects, cvData.certifications
      ];
      const filled = fields.filter(f => f && f.trim()).length;
      const percent = Math.min(100, Math.round((filled / 10) * 100));
      document.querySelector('#profileProgress > div').style.width = `${percent}%`;
      document.getElementById('profilePercent').textContent = `${percent}% Complete`;
    }

    // ‚úÖ Calendar Generation
    function generateCalendar(month, year) {
      const calendarGrid = document.getElementById('calendarGrid');
      calendarGrid.innerHTML = '';
      
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      days.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-day';
        dayHeader.style.background = '#e2e8f0';
        dayHeader.style.fontWeight = 'bold';
        dayHeader.style.color = '#1e293b';
        dayHeader.textContent = day;
        calendarGrid.appendChild(dayHeader);
      });
      
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const totalDays = lastDay.getDate();
      const startDayOfWeek = firstDay.getDay();
      
      for (let i = 0; i < startDayOfWeek; i++) {
        const emptyCell = document.createElement('div');
        emptyCell.className = 'calendar-day';
        emptyCell.style.background = 'transparent';
        emptyCell.style.border = 'none';
        calendarGrid.appendChild(emptyCell);
      }
      
      const today = new Date();
      const currentYear = today.getFullYear();
      const currentMonth = today.getMonth();
      const currentDay = today.getDate();
      
      for (let day = 1; day <= totalDays; day++) {
        const dayCell = document.createElement('div');
        dayCell.className = 'calendar-day';
        dayCell.innerHTML = `<div class="calendar-day-number">${day}</div>`;
        if (year === currentYear && month === currentMonth && day === currentDay) {
          dayCell.classList.add('today');
        }
        calendarGrid.appendChild(dayCell);
      }
    }

    // ‚úÖ DOM Ready
    document.addEventListener('DOMContentLoaded', async () => {
      // Logout
      document.getElementById('logoutBtn').addEventListener('click', () => {
        localStorage.removeItem('studyconnectUser');
        window.location.href = 'index.html';
      });

      // Modals
      const modals = {
        cv: document.getElementById('cvModal'),
        editCv: document.getElementById('editCvModal'),
        apps: document.getElementById('applicationsModal'),
        cal: document.getElementById('calendarModal')
      };

      function closeModal(modal) {
        modal.classList.remove('active');
        document.body.style.overflow = 'auto';
      }

      Object.values(modals).forEach(modal => {
        modal.querySelector('.close-modal')?.addEventListener('click', () => closeModal(modal));
      });

      document.querySelectorAll('.modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', e => {
          if (e.target === overlay) closeModal(overlay);
        });
      });

      // View CV - NOW LOADS FROM DATABASE
      document.getElementById('openCvModal').addEventListener('click', async () => {
        showCustomPopup('‚è≥ Loading your CV...');
        const data = await loadCvFromBackend();
        const content = document.getElementById('cvContent');
        
        if (data) {
          // Build CV content with data from DB
          const emailHtml = `<div class="contact-item"><svg class="contact-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg><span>${data.email}</span></div>`;
          const phoneHtml = `<div class="contact-item"><svg class="contact-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg><span>${data.phone}</span></div>`;
          const addressHtml = data.address ? `<div class="contact-item"><svg class="contact-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg><span>${data.address}</span></div>` : `<div class="contact-item"><svg class="contact-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg><span>Not provided</span></div>`;
          
          const educationHtml = data.education ? `<div class="section-content">${data.education.replace(/\n/g, '<br>')}</div>` : `<div class="section-content"><p class="empty-state">No education information provided yet</p></div>`;
          const skillsHtml = data.skills ? `<div class="section-content">${data.skills.replace(/\n/g, '<br>')}</div>` : `<div class="section-content"><p class="empty-state">No skills added yet</p></div>`;
          const experienceHtml = data.experience ? `<div class="section-content">${data.experience.replace(/\n/g, '<br>')}</div>` : `<div class="section-content"><p class="empty-state">No work experience added yet</p></div>`;
          const projectsHtml = data.projects ? `<div class="section-content">${data.projects.replace(/\n/g, '<br>')}</div>` : `<div class="section-content"><p class="empty-state">No projects added yet</p></div>`;
          const certificationsHtml = data.certifications ? `<div class="section-content">${data.certifications.replace(/\n/g, '<br>')}</div>` : `<div class="section-content"><p class="empty-state">No certifications added yet</p></div>`;
          
          content.innerHTML = `
            <div class="profile-section">
              <div class="profile-name">${data.firstName} ${data.lastName}</div>
              <div class="contact-info">
                ${emailHtml}
                ${phoneHtml}
                ${addressHtml}
              </div>
            </div>
            <div class="section">
              <div class="section-header">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                </svg>
                <h2 class="section-title">Education</h2>
              </div>
              ${educationHtml}
            </div>
            <div class="section">
              <div class="section-header">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                </svg>
                <h2 class="section-title">Skills</h2>
              </div>
              ${skillsHtml}
            </div>
            <div class="section">
              <div class="section-header">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9 1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                </svg>
                <h2 class="section-title">Experience</h2>
              </div>
              ${experienceHtml}
            </div>
            <div class="section">
              <div class="section-header">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M16 4v12m0 0l-4-4m4 4l4-4"/>
                </svg>
                <h2 class="section-title">Projects</h2>
              </div>
              ${projectsHtml}
            </div>
            <div class="section">
              <div class="section-header">
                <svg class="section-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <h2 class="section-title">Certifications</h2>
              </div>
              ${certificationsHtml}
            </div>
          `;
          updateProfileCompletion(data);
        } else {
          content.innerHTML = '<p style="text-align: center; padding: 20px; color: #64748b;">No CV data found. Please update your profile.</p>';
          document.querySelector('#profileProgress > div').style.width = '0%';
          document.getElementById('profilePercent').textContent = '0% Complete';
        }
        modals.cv.classList.add('active');
        document.body.style.overflow = 'hidden';
      });

      // Update CV - NOW SAVES TO DATABASE
      document.getElementById('openUpdateCvModal').addEventListener('click', async () => {
        const data = await loadCvFromBackend();
        if (data) {
          document.getElementById('firstName').value = data.firstName || '';
          document.getElementById('lastName').value = data.lastName || '';
          document.getElementById('email').value = data.email || user.email || '';
          document.getElementById('phone').value = data.phone || '';
          document.getElementById('address').value = data.address || '';
          document.getElementById('education').value = data.education || '';
          document.getElementById('skills').value = data.skills || '';
          document.getElementById('experience').value = data.experience || '';
          document.getElementById('projects').value = data.projects || '';
          document.getElementById('certifications').value = data.certifications || '';
        } else {
          document.getElementById('editCvForm').reset();
          document.getElementById('email').value = user.email || '';
        }
        modals.editCv.classList.add('active');
        document.body.style.overflow = 'hidden';
      });

      document.getElementById('cancelCvEdit').addEventListener('click', () => {
        closeModal(modals.editCv);
      });

      // Save CV to database
      document.getElementById('editCvForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
          email: document.getElementById('email').value.trim(),
          firstName: document.getElementById('firstName').value.trim(),
          lastName: document.getElementById('lastName').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          address: document.getElementById('address').value.trim(),
          education: document.getElementById('education').value.trim(),
          skills: document.getElementById('skills').value.trim(),
          experience: document.getElementById('experience').value.trim(),
          projects: document.getElementById('projects').value.trim(),
          certifications: document.getElementById('certifications').value.trim()
        };
        if (!data.firstName || !data.lastName || !data.email || !data.phone) {
          showCustomPopup('‚ùå Please fill all required fields.');
          return;
        }
        const result = await saveCvToBackend(data);
        if (result) {
          closeModal(modals.editCv);
          updateProfileCompletion(data);
          // Reload CV modal if open
          if (modals.cv.classList.contains('active')) {
            document.getElementById('openCvModal').click();
          }
        }
      });

      // Other modals
      document.getElementById('openApplicationsModal').addEventListener('click', () => {
        modals.apps.classList.add('active');
        document.body.style.overflow = 'hidden';
      });

      document.getElementById('openCalendarModal').addEventListener('click', () => {
        const now = new Date();
        document.getElementById('monthSelector').value = now.getMonth();
        document.getElementById('yearSelector').value = now.getFullYear();
        generateCalendar(now.getMonth(), now.getFullYear());
        modals.cal.classList.add('active');
        document.body.style.overflow = 'hidden';
      });

      // Calendar navigation
      document.getElementById('prevMonth').addEventListener('click', () => {
        let month = parseInt(document.getElementById('monthSelector').value);
        let year = parseInt(document.getElementById('yearSelector').value);
        if (month === 0) { month = 11; year--; } else { month--; }
        document.getElementById('monthSelector').value = month;
        document.getElementById('yearSelector').value = year;
        generateCalendar(month, year);
      });

      document.getElementById('nextMonth').addEventListener('click', () => {
        let month = parseInt(document.getElementById('monthSelector').value);
        let year = parseInt(document.getElementById('yearSelector').value);
        if (month === 11) { month = 0; year++; } else { month++; }
        document.getElementById('monthSelector').value = month;
        document.getElementById('yearSelector').value = year;
        generateCalendar(month, year);
      });

      ['monthSelector', 'yearSelector'].forEach(id => {
        document.getElementById(id).addEventListener('change', () => {
          const month = parseInt(document.getElementById('monthSelector').value);
          const year = parseInt(document.getElementById('yearSelector').value);
          generateCalendar(month, year);
        });
      });

      // Initial load
      const initialCv = await loadCvFromBackend();
      if (initialCv) updateProfileCompletion(initialCv);
    });
  </script>
</body>
</html>